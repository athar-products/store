<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الشراء</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="main-header">
        <div class="logo-name">
            <img src="images/logo.jpg" alt="شعار المتجر" class="logo">
            <span class="store-name">متجري</span>
        </div>
        <nav class="main-nav">
            <ul class="nav-links">
                <li><a href="index.html">الرئيسية</a></li>
                <li><a href="about.html">من نحن</a></li>
                <li><a href="contact.html">اتصل بنا</a></li>
            </ul>
        </nav>
        <div class="cart-and-hamburger">
            <a href="cart.html" class="cart-icon-link">
                <i class="fas fa-shopping-cart cart-icon"></i>
                <span class="cart-count">0</span>
            </a>
            <button class="hamburger-menu" aria-label="قائمة التنقل">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <main class="checkout-page">
        <h1>إتمام الشراء</h1>
        
        <div class="checkout-container">
            <form id="checkoutForm" class="checkout-form">
                <div class="form-section">
                    <h2>معلومات الزبون</h2>
                    <div class="form-group">
                        <label for="fullName">الاسم الكامل:</label>
                        <input type="text" id="fullName" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">رقم الهاتف:</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="secondaryPhone">رقم هاتف احتياطي (اختياري):</label>
                        <input type="tel" id="secondaryPhone" name="secondaryPhone">
                    </div>
                </div>

                <div class="form-section">
                    <h2>معلومات التوصيل</h2>
                    <div class="form-group">
                        <label for="state">الولاية:</label>
                        <select id="state" name="state" required>
                            <option value="">اختر الولاية</option>
                            <!-- سيتم ملؤها بالجافاسكربت -->
                        </select>
                    </div>

                    <div class="delivery-options" id="deliveryOptions" style="display: none;">
                        <label>طريقة التوصيل:</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="deliveryType" value="office" checked>
                                التوصيل إلى المكتب
                            </label>
                            <label>
                                <input type="radio" name="deliveryType" value="home">
                                التوصيل إلى المنزل
                            </label>
                        </div>

                        <div class="home-delivery-details" id="homeDeliveryDetails" style="display: none;">
                            <div class="form-group">
                                <label for="town">البلدية:</label>
                                <input type="text" id="town" name="town">
                            </div>
                            <div class="form-group">
                                <label for="areaDescription">وصف المنطقة:</label>
                                <textarea id="areaDescription" name="areaDescription" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>ملخص الطلب</h2>
                    <div class="order-summary">
                        <div class="summary-row">
                            <span>المجموع:</span>
                            <span id="orderSubtotal">0 د.ج</span>
                        </div>
                        <div class="summary-row">
                            <span>سعر التوصيل:</span>
                            <span id="deliveryCost">0 د.ج</span>
                        </div>
                        <div class="summary-row total">
                            <span>المجموع الكلي:</span>
                            <span id="orderTotal">0 د.ج</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-order-btn">تأكيد الطلب</button>
            </form>
        </div>
    </main>

    <script src="script.js"></script>
<script>
    // بيانات الولايات وأسعار التوصيل (محدثة حسب مدخلاتك)
    const statesData = {
        "Adrar": { home: 1450, office: 1070 },
        "Chlef": { home: 850, office: 570 },
        "Laghouat": { home: 950, office: 670 },
        "Oum El Bouaghi": { home: 800, office: 570 },
        "Batna": { home: 900, office: 570 },
        "Bejaia": { home: 900, office: 570 },
        "Biskra": { home: 950, office: 670 },
        "Bechar": { home: 1200, office: 770 },
        "Blida": { home: 700, office: 520 },
        "Bouira": { home: 750, office: 570 },
        "Tamanrasset": { home: 1650, office: 1270 },
        "Tebessa": { home: 950, office: 570 },
        "Tlemcen": { home: 900, office: 570 },
        "Tiaret": { home: 850, office: 520 },
        "Tizi Ouzou": { home: 750, office: 570 },
        "Alger": { home: 600, office: 520 },
        "Djelfa": { home: 950, office: 670 },
        "Jijel": { home: 900, office: 570 },
        "Sétif": { home: 850, office: 570 },
        "Saida": { home: 900, office: 620 },
        "Skikda": { home: 900, office: 570 },
        "Sidi Bel Abbès": { home: 900, office: 570 },
        "Annaba": { home: 900, office: 570 },
        "Guelma": { home: 850, office: 570 },
        "Constantine": { home: 850, office: 570 },
        "Medea": { home: 850, office: 570 },
        "Mostaganem": { home: 900, office: 570 },
        "M'Sila": { home: 900, office: 570 },
        "Mascara": { home: 900, office: 570 },
        "Ouargla": { home: 1000, office: 670 },
        "Oran": { home: 850, office: 570 },
        "El Bayadh": { home: 1100, office: 670 },
        "Illizi": { home: 0, office: 0 },
        "Bordj Bou Arreridj": { home: 850, office: 570 },
        "Boumerdes": { home: 500, office: 420 },
        "El Tarf": { home: 900, office: 570 },
        "Tindouf": { home: 0, office: 0 },
        "Tissemsilt": { home: 900, office: 520 },
        "El Oued": { home: 1000, office: 670 },
        "Khenchela": { home: 900, office: 0 },
        "Souk Ahras": { home: 900, office: 570 },
        "Tipaza": { home: 800, office: 570 },
        "Mila": { home: 900, office: 570 },
        "Ain Defla": { home: 900, office: 570 },
        "Naama": { home: 1200, office: 670 },
        "Ain Temouchent": { home: 900, office: 570 },
        "Ghardaia": { home: 950, office: 670 },
        "Relizane": { home: 900, office: 570 },
        "Timimoun": { home: 1450, office: 0 },
        "Bordj Badji Mokhtar": { home: 0, office: 0 },
        "Ouled Djellal": { home: 950, office: 670 },
        "Béni Abbès": { home: 1100, office: 1070 },
        "In Salah": { home: 1650, office: 0 },
        "In Guezzam": { home: 1650, office: 0 },
        "Touggourt": { home: 950, office: 670 },
        "Djanet": { home: 0, office: 0 },
        "M'Ghair": { home: 950, office: 0 },
        "Meniaa": { home: 1100, office: 0 }
    };

    document.addEventListener('DOMContentLoaded', function() {
        loadCartFromStorage();
        updateCartCount();

        // ملء قائمة الولايات مع استبعاد الولايات التي سعرها 0
        const stateSelect = document.getElementById('state');
        for (const state in statesData) {
            if (statesData[state].home > 0 || statesData[state].office > 0) {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            }
        }

        // تحديث خيارات التوصيل عند اختيار الولاية
        stateSelect.addEventListener('change', function() {
            const deliveryOptions = document.getElementById('deliveryOptions');
            const homeDeliveryDetails = document.getElementById('homeDeliveryDetails');
            
            if (this.value && (statesData[this.value].home > 0 || statesData[this.value].office > 0)) {
                deliveryOptions.style.display = 'block';
                
                // تعطيل خيار التوصيل للمنزل إذا كان السعر 0
                const homeDeliveryOption = document.querySelector('input[value="home"]');
                homeDeliveryOption.disabled = statesData[this.value].home <= 0;
                
                // تعطيل خيار التوصيل للمكتب إذا كان السعر 0
                const officeDeliveryOption = document.querySelector('input[value="office"]');
                officeDeliveryOption.disabled = statesData[this.value].office <= 0;
                
                // اختيار الخيار المتاح افتراضيًا
                if (statesData[this.value].office > 0) {
                    officeDeliveryOption.checked = true;
                    homeDeliveryDetails.style.display = 'none';
                } else if (statesData[this.value].home > 0) {
                    homeDeliveryOption.checked = true;
                    homeDeliveryDetails.style.display = 'block';
                }
                
                updateDeliveryCost();
            } else {
                deliveryOptions.style.display = 'none';
                homeDeliveryDetails.style.display = 'none';
            }
        });

        // إظهار/إخفاء تفاصيل التوصيل للمنزل
        document.querySelectorAll('input[name="deliveryType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const homeDeliveryDetails = document.getElementById('homeDeliveryDetails');
                if (this.value === 'home') {
                    homeDeliveryDetails.style.display = 'block';
                } else {
                    homeDeliveryDetails.style.display = 'none';
                }
                updateDeliveryCost();
            });
        });

        // تحديث تكلفة التوصيل
        function updateDeliveryCost() {
            const state = stateSelect.value;
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
            
            if (state && deliveryType) {
                const deliveryCost = statesData[state][deliveryType] || 0;
                document.getElementById('deliveryCost').textContent = deliveryCost + ' د.ج';
                
                // حساب المجموع الكلي
                const savedCart = JSON.parse(localStorage.getItem('cart')) || [];
                const subtotal = savedCart.reduce((total, item) => total + (item.price * item.quantity), 0);
                document.getElementById('orderSubtotal').textContent = subtotal + ' د.ج';
                document.getElementById('orderTotal').textContent = (subtotal + deliveryCost) + ' د.ج';
            }
        }

        // إرسال الطلب
        document.getElementById('checkoutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // هنا يمكنك إضافة كود لإرسال البيانات إلى الخادم
            alert('تم استلام طلبك بنجاح! سنتصل بك لتأكيد التفاصيل.');
            
            // مسح السلة بعد إتمام الطلب
            localStorage.removeItem('cart');
            updateCartCount();
            window.location.href = 'index.html';
        });
    });
</script>
</body>
</html>
